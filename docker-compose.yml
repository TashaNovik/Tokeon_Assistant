services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_data:/qdrant/storage:z

  telegram_bot:
    build:
      context: .
      dockerfile: telegram_bot/Dockerfile
    container_name: telegram_bot
    ports:
      - "8000:8000"
    volumes:
      - ./:/telegram_bot
    command: >
      uvicorn telegram_bot.main:app
      --host 0.0.0.0
      --port 8000
    environment:
      - TOKEON_ASSISTANT_REST_API_URL=http://tokeon_assistant_rest_api:8001

  knowledge_base_api:
    build:
      context: .
      dockerfile: knowledge_base_api/Dockerfile
    container_name: knowledge_base_api
    ports:
      - "8002:8002"
    volumes:
      - ./:/knowledge_base_api
      - context:/knowledge_base_api/context
      - fasttext:/knowledge_base_api/fasttext
    depends_on:
      - qdrant
    command: >
      uvicorn knowledge_base_api.main:app
      --host 0.0.0.0
      --port 8002
    environment: #
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333

  tokeon_assistant_rest_api:
    build:
      context: .
      dockerfile: tokeon_assistant_rest_api/Dockerfile
    container_name: tokeon_assistant_rest_api
    ports:
      - "8001:8001"
    volumes:
      - ./:/tokeon_assistant_rest_api
      - context:/tokeon_assistant_rest_api/context
      - fasttext:/tokeon_assistant_rest_api/fasttext
    depends_on:
      - qdrant
    command: >
      uvicorn tokeon_assistant_rest_api.main:app
      --host 0.0.0.0
      --port 8001
    environment: #
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333

volumes:
  qdrant_data:
  context:
  fasttext: